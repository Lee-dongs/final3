<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="attendanceMapper">
  
  <resultMap type="attendance" id="attendanceResultSet">
	  <result column="ATT_RECORD_NO" property="attRecordNo"/>
	  <result column="USER_NO" property="userNo"/>
	  <result column="ON_TIME" property="onTime"/>
	  <result column="OFF_TIME" property="offTime"/>
	  <result column="LEAVE_TYPE" property="leaveType"/>
	  <result column="CURRDATE" property="currDate"/>
	  <result column="TODO_CONTENT" property="todoContent"/>
	  <result column="TODO_NO" property="todoNo"/>
  </resultMap>
  
  <resultMap type="leave" id="leaveResultSet">
  	<result column="LEAVE_TYPE" property="leaveCode"/>
  	<result column="START_DATE" property="startDate"/>
  	<result column="END_DATE" property="endDate"/>
  </resultMap>
  
  <select id="attendanceList" resultMap="attendanceResultSet">
  SELECT ATT_RECORD_NO, USER_NO, TO_CHAR(ON_TIME, 'HH24:MI') AS ON_TIME,
  	 TO_CHAR(OFF_TIME, 'HH24:MI') AS OFF_TIME, LEAVE_TYPE, TO_CHAR(ON_TIME, 'YYYY-MM-DD') AS CURRDATE
  FROM ATTENDANCE_RECORD
  JOIN WORK_TYPE USING(LEAVE_CODE)
  WHERE USER_NO = #{userNo}
  </select>
  
  <select id="attendanceMain" resultMap="attendanceResultSet">
  SELECT ATT_RECORD_NO, USER_NO, TO_CHAR(ON_TIME, 'HH24:MI') AS ON_TIME,
  	 TO_CHAR(OFF_TIME, 'HH24:MI') AS OFF_TIME, LEAVE_TYPE, TO_CHAR(ON_TIME, 'YYYY-MM-DD') AS CURRDATE
  FROM ATTENDANCE_RECORD
  JOIN WORK_TYPE USING(LEAVE_CODE)
  WHERE USER_NO = #{userNo}
  AND TO_CHAR(ON_TIME, 'YYYY-MM-DD') = TO_CHAR(SYSDATE, 'YYYY-MM-DD')

  </select>
  
  <insert id="insertTodo">
  INSERT INTO TODO (TODO_NO, USER_NO, TODO_CONTENT, STATUS)
  VALUES (SEQ_TNO.NEXTVAL, #{userNo}, #{todoContent}, 'T')
  </insert>
  
  <update id="updateTodo">
  UPDATE TODO
  SET TODO_CONTENT = #{todoContent}
  WHERE USER_NO = #{userNo}
  AND STATUS = 'T'
  </update>
  
  <select id="selectTodo" resultMap="attendanceResultSet">
  SELECT TODO_CONTENT
  FROM TODO
  WHERE USER_NO = #{userNo}
  AND STATUS = 'T'
  </select>
  
  <select id="selectLeaveList" resultMap="leaveResultSet">
  SELECT LEAVE_TYPE, START_DATE, END_DATE
  FROM LEAVE L
  JOIN APPROVAL_DOC A USING(DOC_NO)
  JOIN WORK_TYPE USING(LEAVE_CODE)
  WHERE A.STATUS = 'Y'
  AND A.DOC_WRITER = ${userNo}
  AND L.LEAVE_STATUS = '신청'
  </select>
  
  
  </mapper>